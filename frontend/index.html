<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ECHOLOVE Directory</title>
    <!-- Load Tailwind CSS from CDN for quick styling -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 font-sans">
    <header class="bg-indigo-600 text-white py-4">
      <h1 class="text-3xl text-center font-bold">ECHOLOVE Directory</h1>
    </header>
    <main class="container mx-auto p-4" id="app">
      <input
        id="searchInput"
        type="text"
        placeholder="Search for tools"
        class="w-full p-2 border rounded mb-4"
      />
      <div
        id="toolsContainer"
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"
      ></div>
    </main>
    <footer class="text-center text-xs text-gray-500 py-4">
      &copy; <span id="year"></span> ECHOLOVE. All rights reserved.
    </footer>
    <script>
      // Set current year in footer
      document.getElementById("year").textContent = new Date().getFullYear();

      async function fetchTools(query = "") {
        let url = "http://localhost:8000/tools";
        if (query) {
          url += "?q=" + encodeURIComponent(query);
        }
        try {
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error("Failed to fetch tools");
          }
          const tools = await response.json();
          const container = document.getElementById("toolsContainer");
          container.innerHTML = "";
          tools.forEach((tool) => {
            const card = document.createElement("div");
            card.className =
              "bg-white rounded-lg shadow p-4 flex flex-col transition hover:shadow-lg";
            const name = document.createElement("h2");
            name.className = "text-xl font-semibold mb-2 text-indigo-800";
            name.textContent = tool.name;
            const desc = document.createElement("p");
            desc.className = "text-gray-700 mb-2";
            desc.textContent = tool.description || "";
            const tagsContainer = document.createElement("div");
            tagsContainer.className = "mb-2";
            if (tool.tags) {
              const tags = tool.tags.split(",");
              tags.forEach((tag) => {
                const span = document.createElement("span");
                span.className =
                  "inline-block bg-indigo-200 text-indigo-800 text-xs px-2 py-1 rounded mr-1 mb-1";
                span.textContent = tag.trim();
                tagsContainer.appendChild(span);
              });
            }
            card.appendChild(name);
            card.appendChild(desc);
            card.appendChild(tagsContainer);
            // Add first review snippet if available
            if (tool.reviews && tool.reviews.length > 0) {
              const review = tool.reviews[0];
              const revDiv = document.createElement("div");
              revDiv.className =
                "mt-auto pt-2 border-t text-sm text-gray-600 italic";
              revDiv.textContent = review.snippet;
              card.appendChild(revDiv);
            }
            container.appendChild(card);
          });
        } catch (err) {
          console.error(err);
        }
      }

      document
        .getElementById("searchInput")
        .addEventListener("input", function (e) {
          fetchTools(e.target.value);
        });
      // Initial load
      fetchTools();
    </script>
  </body>
</html>